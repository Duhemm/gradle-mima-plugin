plugins {
    id 'java-gradle-plugin'
    id 'scala'
    id "com.github.maiflai.scalatest" version "0.26"
    // Publishing to maven
    id 'maven-publish'
}

group 'the.flowering.branches'
version '0.0.0'

repositories {
    mavenCentral()
}

dependencies {
    def mima = "0.7.0"
    def scalaLangVersion = 2.12
    implementation "com.typesafe:mima-core_$scalaLangVersion:$mima"
    testImplementation "org.scalatest:scalatest_$scalaLangVersion:3.1.1"
    implementation gradleApi()
    testRuntime 'com.vladsch.flexmark:flexmark-profile-pegdown:0.35.10'
}

gradlePlugin {
    plugins {
        mima {
            id = "the.flowering.branches.gradle-mima"
            implementationClass = "the.flowering.branches.MimaPlugin"
        }
    }
}

task sourcesJar(type: Jar, dependsOn: classes) {
    from sourceSets.main.allSource
    archiveClassifier = 'sources'
}

//jar {
//    manifest {
//        attributes 'Implementation-Title': 'Gradle mima plugin',
//            'Implementation-Version': archiveVersion,
//            'Built-Date': new Date(),
//            'Built-JDK': System.getProperty('java.version'),
//            'Built-Gradle': gradle.gradleVersion
//    }
//}

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
            artifact sourcesJar
        }
    }
}